{{left_sidebar_enabled=False,right_sidebar_enabled=False,('message' in globals())}}
{{extend 'layout.html'}}

<div id="target"></div>
<script id="template" type="text/ractive">
    {{block left_sidebar}}
      <div class="panel panel-info">
          <div class="panel-heading"><h3 class="panel-title"><a class="btn-block" href="#">
              <i class="fa fa-home fa-fw fa-3x" aria-hidden="true"></i><font size="4">Family Home</font></a></h3>
          </div>
          <ul class="list-group">
            <li class="list-group-item">
                <a href="#"><i class="fa fa-sun-o fa-fw" aria-hidden="true"></i>Nest Thermostat</a>
            </li>
            <li class="list-group-item">
                <a href="#"><i class="fa fa-television fa-fw" aria-hidden="true"></i>Samsung Smart TV</a>
            </li>
            <li class="list-group-item" on-click='car_click'>
                <a href="#"><i class="fa fa-car fa-fw" aria-hidden="true"></i>Tesla Model S</a>
            </li>
            <li class="list-group-item">
                <a href="#"><i class="fa fa-tint fa-fw" aria-hidden="true"></i>Sprinkler System</a>
            </li>
          </ul>
        </div>

        <div class="panel panel-info">
          <div class="panel-heading"><h3 class="panel-title"><a class="btn-block" href="{{=URL('admin','default','index')}}">
              <i class="fa fa-plane fa-fw fa-3x" aria-hidden="true"></i><font size="4">Vacation Villa</font></a></h3>
          </div>
          <ul class="list-group">
            <li class="list-group-item">
                <a href="#"><i class="fa fa-video-camera fa-fw" aria-hidden="true"></i>Security Camera</a>
            </li>
            <li class="list-group-item">
                <a href="#"><i class="fa fa-fax fa-fw" aria-hidden="true"></i>Fax Machine</a>
            </li>
            <li class="list-group-item">
                <a href="#"><i class="fa fa-lightbulb-o fa-fw" aria-hidden="true"></i>Phillps Hue</a>
            </li>
            <li class="list-group-item">
                <a href="#"><i class="fa fa-gamepad fa-fw" aria-hidden="true"></i>Xbox One</a>
            </li>
          </ul>
        </div>
    {{end}}

    <div id="middle_bar" align="center">
        <h1 align="center">{% name %}</h1>
        <div id="curve_chart" style="width: 900px; height: 500px"></div>
    </div>

    {{block right_sidebar}}
        <div id="device_info" align="center">
        <h1>Status</h1>
        <button type="button" class="btn btn-primary" onclick="editClick()">
            <i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i><font size="1">Edit Script</font>
        </button><br><br>
        <ul class="list-group">
            <li class="list-group-item"><span class="badge"><i class="fa fa-check" aria-hidden="true"></i></span>Status: OK</li>
            <li class="list-group-item">Last synced: December 31, 1969</li>
            <li class="list-group-item">Next sync in: <span id="time"></span></li>
        </ul>
        </div>
    {{end}}
</script>
<script>
    // =============== Ractive ===================================
    var ractive = new Ractive({
      // The `el` option can be a node, an ID, or a CSS selector.
      el: '#target',

      // We could pass in a string, but for the sake of convenience
      // we're passing the ID of the <script> tag above.
      template: '#template',

      delimiters: ['{%', '%}'],
      tripleDelimiters: ['{%%', '%%}'],

      // Here, we're passing in some initial data
      data: { name: 'Nest Thermostat' }
    });

    ractive.on({
        'car_click': function(){
            ractive.set('name', "Tesla Model S");
        }
    });

    // ============== Graphs =====================================
    // Load the Visualization API and the corechart package.
      google.charts.load('current', {'packages':['corechart']});

      // Set a callback to run when the Google Visualization API is loaded.
      google.charts.setOnLoadCallback(drawChart);

      // Callback that creates and populates a data table,
      // instantiates the pie chart, passes in the data and
      // draws it.
      function drawChart() {
        var data = google.visualization.arrayToDataTable([
          ['Day', 'This week', 'Last week'],
          ['Saturday',  62,      25],
          ['Sunday',    73,      28],
          ['Yesterday', 41,      70],
          ['Today',     64,      34]
        ]);

        var options = {
          curveType: 'function',
          legend: { position: 'bottom' }
        };

        var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));

        chart.draw(data, options);
      }

    // =============== Sync Timer ===================
    function startTimer(duration, display) {
        var timer = duration, minutes, seconds;
        setInterval(function () {
            minutes = parseInt(timer / 60, 10);
            seconds = parseInt(timer % 60, 10);

            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            display.textContent = minutes + ":" + seconds;

            if (--timer < 0) {
                timer = duration;
                notifyMe();
            }
        }, 1000);
    }

    window.onload = function () {
        var fiveMinutes = 60 * 1,
            display = document.querySelector('#time');
        startTimer(fiveMinutes, display);
    };

    // =========== Misc ====================
    // Edit Script alert box
    function editClick() {
        alert("Work in progress, not added yet");
    }

    // Chrome notifications
    // request permission on page load
    document.addEventListener('DOMContentLoaded', function () {
      if (Notification.permission !== "granted")
        Notification.requestPermission();
    });

    function notifyMe() {
      if (!Notification) return;
      if (Notification.permission !== "granted") Notification.requestPermission();
      else {
        var notification = new Notification('Device synced', {
          icon: '',
          body: "One of your devices has synced",
        });

        notification.onclick = function () {
          window.open("http://127.0.0.1:8800/#");
        };
      }
    }
</script>